import{a as Y}from"./chunk-XJQFBIAP.js";import{a as B,b as K,c as Z}from"./chunk-G3PVE4XB.js";import"./chunk-5XHP5UMK.js";import{A as w,Ab as j,B as l,C as u,Cb as L,Eb as V,G as p,I as P,Ja as _,N as R,Q as d,S as N,V as y,Y as D,_ as C,a as O,cc as I,gc as x,ha as W,ia as F,ic as H,j as M,jc as z,lc as G,mc as $,n as v,nc as q,o as A,qa as U,r as a,v as k,w as E,y as b,ya as T}from"./chunk-J433ULLT.js";var J=[{path:"",loadComponent:()=>import("./chunk-H2KV746O.js").then(t=>t.AppComponent)},{path:"reader/:chapterId",loadComponent:()=>import("./chunk-DQGIPTMF.js").then(t=>t.ReaderComponent)},{path:"worker-management",loadComponent:()=>import("./chunk-6X6PAOAA.js").then(t=>t.WorkerManagementComponent)},{path:"**",redirectTo:""}];var f="Service workers are disabled or not supported by this browser";function ne(t){return E(()=>A(new Error(t)))}var h=class{constructor(r){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=ne(f);else{let n=b(r,"controllerchange").pipe(a(()=>r.controller)),i=E(()=>v(r.controller)),s=k(i,n);this.worker=s.pipe(u(c=>!!c)),this.registration=this.worker.pipe(d(()=>r.getRegistration()));let S=b(r,"message").pipe(a(c=>c.data)).pipe(u(c=>c&&c.type)).pipe(R());S.connect(),this.events=S}}postMessage(r,e){return this.worker.pipe(p(1),N(n=>{n.postMessage(O({action:r},e))})).toPromise().then(()=>{})}postMessageWithOperation(r,e,n){let i=this.waitForOperationCompleted(n),s=this.postMessage(r,e);return Promise.all([s,i]).then(([,o])=>o)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=n=>n.type===r:e=n=>r.includes(n.type),this.events.pipe(u(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(p(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe(u(e=>e.nonce===r),p(1),a(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},ie=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,this.pushManager=null,this.subscriptionChanges=new M,!e.isEnabled){this.messages=l,this.notificationClicks=l,this.subscription=l;return}this.messages=this.sw.eventsOfType("PUSH").pipe(a(i=>i.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(a(i=>i.data)),this.pushManager=this.sw.registration.pipe(a(i=>i.pushManager));let n=this.pushManager.pipe(d(i=>i.getSubscription()));this.subscription=w(n,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(f));let n={userVisibleOnly:!0},i=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(i.length));for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);return n.applicationServerKey=s,this.pushManager.pipe(d(o=>o.subscribe(n)),p(1)).toPromise().then(o=>(this.subscriptionChanges.next(o),o))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(f));let e=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(i=>{if(!i)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(p(1),d(e)).toPromise()}decodeBase64(e){return atob(e)}static{this.\u0275fac=function(n){return new(n||t)(C(h))}}static{this.\u0275prov=y({token:t,factory:t.\u0275fac})}}return t})(),oe=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=l,this.unrecoverable=l;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(f));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(f));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static{this.\u0275fac=function(n){return new(n||t)(C(h))}}static{this.\u0275prov=y({token:t,factory:t.\u0275fac})}}return t})();var Q=new D("");function se(t,r,e,n){return()=>{if(!(I(n)&&"serviceWorker"in navigator&&e.enabled!==!1))return;navigator.serviceWorker.addEventListener("controllerchange",()=>{navigator.serviceWorker.controller!==null&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})});let i;if(typeof e.registrationStrategy=="function")i=e.registrationStrategy();else{let[o,...m]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(o){case"registerImmediately":i=v(null);break;case"registerWithDelay":i=X(+m[0]||0);break;case"registerWhenStable":i=m[0]?w(ee(t),X(+m[0])):ee(t);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}t.get(_).runOutsideAngular(()=>i.pipe(p(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:e.scope}).catch(o=>console.error("Service worker registration failed with:",o))))}}function X(t){return v(null).pipe(P(t))}function ee(t){return t.get(L).isStable.pipe(u(e=>e))}function ae(t,r){return new h(I(r)&&t.enabled!==!1?navigator.serviceWorker:void 0)}var g=class{};function te(t,r={}){return W([ie,oe,{provide:Q,useValue:t},{provide:g,useValue:r},{provide:h,useFactory:ae,deps:[g,T]},{provide:j,useFactory:se,deps:[U,Q,g,T],multi:!0}])}var re={providers:[Z(J),K(),x(),te("ngsw-worker.js",{enabled:!V(),registrationStrategy:"registerWhenStable:30000"}),F([H(()=>z(q.firebase)),G(()=>$())])]};B(Y,re).catch(t=>console.error(t));
