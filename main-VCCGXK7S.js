import{a as Z}from"./chunk-AWHG7WRN.js";import{a as x,b as B,c as K}from"./chunk-N332CFDX.js";import"./chunk-XMZEG4KL.js";import{A as u,E as p,Fa as U,G as A,L as R,Nb as I,O as d,Q as N,Rb as V,S as y,V as D,X as C,a as O,da as W,j as M,mb as _,n as m,na as F,o as k,ob as j,qb as L,r as a,v as P,va as T,w as E,x as w,y as b,z as l}from"./chunk-W24EJRHD.js";var H=[{path:"",loadComponent:()=>import("./chunk-34RRV6EN.js").then(t=>t.AppComponent)},{path:"reader/:chapterId",loadComponent:()=>import("./chunk-KR4GHKW7.js").then(t=>t.ReaderComponent)},{path:"worker-management",loadComponent:()=>import("./chunk-YDVKZWLI.js").then(t=>t.WorkerManagementComponent)},{path:"**",redirectTo:""}];var f="Service workers are disabled or not supported by this browser";function J(t){return E(()=>k(new Error(t)))}var h=class{constructor(r){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=J(f);else{let n=w(r,"controllerchange").pipe(a(()=>r.controller)),i=E(()=>m(r.controller)),o=P(i,n);this.worker=o.pipe(u(c=>!!c)),this.registration=this.worker.pipe(d(()=>r.getRegistration()));let S=w(r,"message").pipe(a(c=>c.data)).pipe(u(c=>c&&c.type)).pipe(R());S.connect(),this.events=S}}postMessage(r,e){return this.worker.pipe(p(1),N(n=>{n.postMessage(O({action:r},e))})).toPromise().then(()=>{})}postMessageWithOperation(r,e,n){let i=this.waitForOperationCompleted(n),o=this.postMessage(r,e);return Promise.all([o,i]).then(([,s])=>s)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=n=>n.type===r:e=n=>r.includes(n.type),this.events.pipe(u(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(p(1))}waitForOperationCompleted(r){return this.eventsOfType("OPERATION_COMPLETED").pipe(u(e=>e.nonce===r),p(1),a(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}},Q=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,this.pushManager=null,this.subscriptionChanges=new M,!e.isEnabled){this.messages=l,this.notificationClicks=l,this.subscription=l;return}this.messages=this.sw.eventsOfType("PUSH").pipe(a(i=>i.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(a(i=>i.data)),this.pushManager=this.sw.registration.pipe(a(i=>i.pushManager));let n=this.pushManager.pipe(d(i=>i.getSubscription()));this.subscription=b(n,this.subscriptionChanges)}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(f));let n={userVisibleOnly:!0},i=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(i.length));for(let s=0;s<i.length;s++)o[s]=i.charCodeAt(s);return n.applicationServerKey=o,this.pushManager.pipe(d(s=>s.subscribe(n)),p(1)).toPromise().then(s=>(this.subscriptionChanges.next(s),s))}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(f));let e=n=>{if(n===null)throw new Error("Not subscribed to push notifications.");return n.unsubscribe().then(i=>{if(!i)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return this.subscription.pipe(p(1),d(e)).toPromise()}decodeBase64(e){return atob(e)}static{this.\u0275fac=function(n){return new(n||t)(C(h))}}static{this.\u0275prov=y({token:t,factory:t.\u0275fac})}}return t})(),X=(()=>{class t{get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=l,this.unrecoverable=l;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(f));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(f));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static{this.\u0275fac=function(n){return new(n||t)(C(h))}}static{this.\u0275prov=y({token:t,factory:t.\u0275fac})}}return t})();var G=new D("");function ee(t,r,e,n){return()=>{if(!(I(n)&&"serviceWorker"in navigator&&e.enabled!==!1))return;navigator.serviceWorker.addEventListener("controllerchange",()=>{navigator.serviceWorker.controller!==null&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})});let i;if(typeof e.registrationStrategy=="function")i=e.registrationStrategy();else{let[s,...v]=(e.registrationStrategy||"registerWhenStable:30000").split(":");switch(s){case"registerImmediately":i=m(null);break;case"registerWithDelay":i=$(+v[0]||0);break;case"registerWhenStable":i=v[0]?b(q(t),$(+v[0])):q(t);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${e.registrationStrategy}`)}}t.get(U).runOutsideAngular(()=>i.pipe(p(1)).subscribe(()=>navigator.serviceWorker.register(r,{scope:e.scope}).catch(s=>console.error("Service worker registration failed with:",s))))}}function $(t){return m(null).pipe(A(t))}function q(t){return t.get(j).isStable.pipe(u(e=>e))}function te(t,r){return new h(I(r)&&t.enabled!==!1?navigator.serviceWorker:void 0)}var g=class{};function z(t,r={}){return W([Q,X,{provide:G,useValue:t},{provide:g,useValue:r},{provide:h,useFactory:te,deps:[g,T]},{provide:_,useFactory:ee,deps:[F,G,g,T],multi:!0}])}var Y={providers:[K(H),B(),V(),z("ngsw-worker.js",{enabled:!L(),registrationStrategy:"registerWhenStable:30000"})]};x(Z,Y).catch(t=>console.error(t));
